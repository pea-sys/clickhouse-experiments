# 上級チュートリアル

- テーブル作成

```
b61e6fae1579 :) CREATE TABLE trips
                (
                    `trip_id` UInt32,
                    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
                    `pickup_date` Date,
                    `pickup_datetime` DateTime,
                    `dropoff_date` Date,
                    `dropoff_datetime` DateTime,
                    `store_and_fwd_flag` UInt8,
                    `rate_code_id` UInt8,
                    `pickup_longitude` Float64,
                    `pickup_latitude` Float64,
                    `dropoff_longitude` Float64,
                    `dropoff_latitude` Float64,
                    `passenger_count` UInt8,
                    `trip_distance` Float64,
                    `fare_amount` Float32,
                    `extra` Float32,
                CREATE TABLE trips
                (
                    `trip_id` UInt32,
                    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
                    `pickup_date` Date,
                    `pickup_datetime` DateTime,
                    `dropoff_date` Date,
                    `dropoff_datetime` DateTime,
                    `store_and_fwd_flag` UInt8,
                    `rate_code_id` UInt8,
                    `pickup_longitude` Float64,
                    `pickup_latitude` Float64,
                    `dropoff_longitude` Float64,
                    `dropoff_latitude` Float64,
                    `passenger_count` UInt8,
                    `trip_distance` Float64,
                    `fare_amount` Float32,
                    `extra` Float32,
                    `mta_tax` Float32,
                    `tip_amount` Float32,
                    `tolls_amount` Float32,
                    `ehail_fee` Float32,
                    `improvement_surcharge` Float32,
                    `total_amount` Float32,
                    `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),
                    `trip_type` UInt8,
                    `pickup` FixedString(25),
                    `dropoff` FixedString(25),
                    `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),
                    `pickup_nyct2010_gid` Int8,
                    `pickup_ctlabel` Float32,
                    `pickup_borocode` Int8,
                    `pickup_ct2010` String,
                    `pickup_boroct2010` String,
                    `pickup_cdeligibil` String,
                    `pickup_ntacode` FixedString(4),
                    `pickup_ntaname` String,
                    `pickup_puma` UInt16,
                    `dropoff_nyct2010_gid` UInt8,
                    `dropoff_ctlabel` Float32,
                    `dropoff_borocode` UInt8,
                    `dropoff_ct2010` String,
                    `dropoff_boroct2010` String,
                    `dropoff_cdeligibil` String,
                    `dropoff_ntacode` FixedString(4),
                    `dropoff_ntaname` String,
                    `dropoff_puma` UInt16
                )
                ENGINE = MergeTree
                PARTITION BY toYYYYMM(pickup_date)
                ORDER BY pickup_datetime;

CREATE TABLE trips
(
    `trip_id` UInt32,
    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
    `pickup_date` Date,
    `pickup_datetime` DateTime,
    `dropoff_date` Date,
    `dropoff_datetime` DateTime,
    `store_and_fwd_flag` UInt8,
    `rate_code_id` UInt8,
    `pickup_longitude` Float64,
    `pickup_latitude` Float64,
    `dropoff_longitude` Float64,
    `dropoff_latitude` Float64,
    `passenger_count` UInt8,
    `trip_distance` Float64,
    `fare_amount` Float32,
    `extra` Float32,
    `mta_tax` Float32,
    `tip_amount` Float32,
    `tolls_amount` Float32,
    `ehail_fee` Float32,
    `improvement_surcharge` Float32,
    `total_amount` Float32,
    `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),
    `trip_type` UInt8,
    `pickup` FixedString(25),
    `dropoff` FixedString(25),
    `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),
    `pickup_nyct2010_gid` Int8,
    `pickup_ctlabel` Float32,
    `pickup_borocode` Int8,
    `pickup_ct2010` String,
    `pickup_boroct2010` String,
    `pickup_cdeligibil` String,
    `pickup_ntacode` FixedString(4),
    `pickup_ntaname` String,
    `pickup_puma` UInt16,
    `dropoff_nyct2010_gid` UInt8,
    `dropoff_ctlabel` Float32,
    `dropoff_borocode` UInt8,
    `dropoff_ct2010` String,
    `dropoff_boroct2010` String,
    `dropoff_cdeligibil` String,
    `dropoff_ntacode` FixedString(4),
    `dropoff_ntaname` String,
    `dropoff_puma` UInt16
)
ENGINE = MergeTree
PARTITION BY toYYYYMM(pickup_date)
ORDER BY pickup_datetime

Query id: 71c9ac42-e2ce-4e59-940c-542017846de9

Ok.

0 rows in set. Elapsed: 0.019 sec.
```

- データ追加

```sql
b61e6fae1579 :) INSERT INTO trips
                SELECT * FROM s3(
                    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_{1..2}.gz',
                    'TabSeparatedWithNames', "
                    `trip_id` UInt32,
                    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
                    `pickup_date` Date,
                    `pickup_datetime` DateTime,
                    `dropoff_date` Date,
                    `dropoff_datetime` DateTime,
                    `store_and_fwd_flag` UInt8,
                    `rate_code_id` UInt8,
                    `pickup_longitude` Float64,
                    `pickup_latitude` Float64,
                    `dropoff_longitude` Float64,
                    `dropoff_latitude` Float64,
                    `passenger_count` UInt8,
                INSERT INTO trips
                SELECT * FROM s3(
                    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_{1..2}.gz',
                    'TabSeparatedWithNames', "
                    `trip_id` UInt32,
                    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
                    `pickup_date` Date,
                    `pickup_datetime` DateTime,
                    `dropoff_date` Date,
                    `dropoff_datetime` DateTime,
                    `store_and_fwd_flag` UInt8,
                    `rate_code_id` UInt8,
                    `pickup_longitude` Float64,
                    `pickup_latitude` Float64,
                    `dropoff_longitude` Float64,
                    `dropoff_latitude` Float64,
                    `passenger_count` UInt8,
                INSERT INTO trips
                SELECT * FROM s3(
                    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_{1..2}.gz',
                    'TabSeparatedWithNames', "
                    `trip_id` UInt32,
                    `vendor_id` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),
                    `pickup_date` Date,
                    `pickup_datetime` DateTime,
                    `dropoff_date` Date,
                    `dropoff_datetime` DateTime,
                    `store_and_fwd_flag` UInt8,
                    `rate_code_id` UInt8,
                    `pickup_longitude` Float64,
                    `pickup_latitude` Float64,
                    `dropoff_longitude` Float64,
                    `dropoff_latitude` Float64,
                    `passenger_count` UInt8,
                    `trip_distance` Float64,
                    `fare_amount` Float32,
                    `extra` Float32,
                    `mta_tax` Float32,
                    `tip_amount` Float32,
                    `tolls_amount` Float32,
                    `ehail_fee` Float32,
                    `improvement_surcharge` Float32,
                    `total_amount` Float32,
                    `payment_type` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),
                    `trip_type` UInt8,
                    `pickup` FixedString(25),
                    `dropoff` FixedString(25),
                    `cab_type` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),
                    `pickup_nyct2010_gid` Int8,
                    `pickup_ctlabel` Float32,
                    `pickup_borocode` Int8,
                    `pickup_ct2010` String,
                    `pickup_boroct2010` String,
                    `pickup_cdeligibil` String,
                    `pickup_ntacode` FixedString(4),
                    `pickup_ntaname` String,
                    `pickup_puma` UInt16,
                    `dropoff_nyct2010_gid` UInt8,
                    `dropoff_ctlabel` Float32,
                    `dropoff_borocode` UInt8,
                    `dropoff_ct2010` String,
                    `dropoff_boroct2010` String,
                    `dropoff_cdeligibil` String,
                    `dropoff_ntacode` FixedString(4),
                    `dropoff_ntaname` String,
                    `dropoff_puma` UInt16
                ");

INSERT INTO trips SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_{1..2}.gz', 'TabSeparatedWithNames', `\n    \`trip_id\` UInt32,\n    \`vendor_id\` Enum8('1' = 1, '2' = 2, '3' = 3, '4' = 4, 'CMT' = 5, 'VTS' = 6, 'DDS' = 7, 'B02512' = 10, 'B02598' = 11, 'B02617' = 12, 'B02682' = 13, 'B02764' = 14, '' = 15),\n    \`pickup_date\` Date,\n    \`pickup_datetime\` DateTime,\n    \`dropoff_date\` Date,\n    \`dropoff_datetime\` DateTime,\n    \`store_and_fwd_flag\` UInt8,\n    \`rate_code_id\` UInt8,\n    \`pickup_longitude\` Float64,\n    \`pickup_latitude\` Float64,\n    \`dropoff_longitude\` Float64,\n    \`dropoff_latitude\` Float64,\n    \`passenger_count\` UInt8,\n    \`trip_distance\` Float64,\n    \`fare_amount\` Float32,\n    \`extra\` Float32,\n    \`mta_tax\` Float32,\n    \`tip_amount\` Float32,\n    \`tolls_amount\` Float32,\n    \`ehail_fee\` Float32,\n    \`improvement_surcharge\` Float32,\n    \`total_amount\` Float32,\n    \`payment_type\` Enum8('UNK' = 0, 'CSH' = 1, 'CRE' = 2, 'NOC' = 3, 'DIS' = 4),\n    \`trip_type\` UInt8,\n    \`pickup\` FixedString(25),\n    \`dropoff\` FixedString(25),\n    \`cab_type\` Enum8('yellow' = 1, 'green' = 2, 'uber' = 3),\n    \`pickup_nyct2010_gid\` Int8,\n    \`pickup_ctlabel\` Float32,\n    \`pickup_borocode\` Int8,\n    \`pickup_ct2010\` String,\n    \`pickup_boroct2010\` String,\n    \`pickup_cdeligibil\` String,\n    \`pickup_ntacode\` FixedString(4),\n    \`pickup_ntaname\` String,\n    \`pickup_puma\` UInt16,\n    \`dropoff_nyct2010_gid\` UInt8,\n    \`dropoff_ctlabel\` Float32,\n    \`dropoff_borocode\` UInt8,\n    \`dropoff_ct2010\` String,\n    \`dropoff_boroct2010\` String,\n    \`dropoff_cdeligibil\` String,\n    \`dropoff_ntacode\` FixedString(4),\n    \`dropoff_ntaname\` String,\n    \`dropoff_puma\` UInt16\n`)

Query id: c2ba494a-a0e1-40ff-82ce-2c779671ad62

Ok.

0 rows in set. Elapsed: 91.327 sec. Processed 2.00 million rows, 633.53 MB (21.90 thousand rows/s., 6.94 MB/s.)
```

- 行数確認

```sql
b61e6fae1579 :) SELECT count() FROM trips;

SELECT count()
FROM trips

Query id: 47b9de41-7b5a-41d2-833f-947c1622179a

┌─count()─┐
│ 1999657 │
└─────────┘

1 rows in set. Elapsed: 0.006 sec.
```

- 重複排除

```sql
b61e6fae1579 :) SELECT DISTINCT(pickup_ntaname) FROM trips;

SELECT DISTINCT pickup_ntaname
FROM trips

Query id: 8e95c433-dbe6-4591-bf4b-d3f6f2459ddf

┌─pickup_ntaname───────────────────────────────────┐
│ Upper West Side                                  │
│ Midtown-Midtown South                            │
│ Clinton                                          │
│ SoHo-TriBeCa-Civic Center-Little Italy           │
│ Murray Hill-Kips Bay                             │
│ Upper East Side-Carnegie Hill                    │
│ Lincoln Square                                   │
│ Hudson Yards-Chelsea-Flatiron-Union Square       │
│ Airport                                          │
│ Battery Park City-Lower Manhattan                │
│ Bushwick South                                   │
│ Lower East Side                                  │
│ Gramercy                                         │
│ East Village                                     │
│ Turtle Bay-East Midtown                          │
│ Chinatown                                        │
│ West Village                                     │
│ Lenox Hill-Roosevelt Island                      │
│                                                  │
│ park-cemetery-etc-Manhattan                      │
│ Bedford                                          │
│ West Concourse                                   │
│ Astoria                                          │
│ Fort Greene                                      │
│ Yorkville                                        │
│ Park Slope-Gowanus                               │
│ East Williamsburg                                │
│ University Heights-Morris Heights                │
│ North Side-South Side                            │
│ Hunters Point-Sunnyside-West Maspeth             │
│ Bushwick North                                   │
│ Morningside Heights                              │
│ East Harlem South                                │
│ Flatbush                                         │
│ DUMBO-Vinegar Hill-Downtown Brooklyn-Boerum Hill │
│ Hamilton Heights                                 │
│ Stuyvesant Town-Cooper Village                   │
│ Prospect Heights                                 │
│ Greenpoint                                       │
│ Fordham South                                    │
│ Brooklyn Heights-Cobble Hill                     │
│ Borough Park                                     │
│ Central Harlem South                             │
│ Soundview-Castle Hill-Clason Point-Harding Park  │
│ Highbridge                                       │
│ Forest Hills                                     │
│ East Harlem North                                │
│ Manhattanville                                   │
│ Crown Heights South                              │
│ Briarwood-Jamaica Hills                          │
│ Steinway                                         │
│ Jackson Heights                                  │
│ Elmhurst                                         │
│ Elmhurst-Maspeth                                 │
│ East Concourse-Concourse Village                 │
│ Carroll Gardens-Columbia Street-Red Hook         │
│ Woodside                                         │
│ Washington Heights South                         │
│ East Elmhurst                                    │
│ Old Astoria                                      │
│ Newark Airport                                   │
│ Prospect Lefferts Gardens-Wingate                │
│ Erasmus                                          │
│ park-cemetery-etc-Queens                         │
│ Washington Heights North                         │
│ Springfield Gardens South-Brookville             │
│ Brighton Beach                                   │
│ Flushing                                         │
│ Central Harlem North-Polo Grounds                │
│ Melrose South-Mott Haven North                   │
│ Jamaica                                          │
│ Rego Park                                        │
│ Crown Heights North                              │
│ Clinton Hill                                     │
│ Sunset Park West                                 │
│ Midwood                                          │
│ Kensington-Ocean Parkway                         │
│ Stuyvesant Heights                               │
│ Williamsburg                                     │
│ Queensbridge-Ravenswood-Long Island City         │
│ Mott Haven-Port Morris                           │
│ Cypress Hills-City Line                          │
│ Bensonhurst West                                 │
│ Dyker Heights                                    │
│ Richmond Hill                                    │
│ South Ozone Park                                 │
│ Canarsie                                         │
│ Kew Gardens Hills                                │
│ Rugby-Remsen Village                             │
│ Windsor Terrace                                  │
│ Spuyten Duyvil-Kingsbridge                       │
│ park-cemetery-etc-Brooklyn                       │
│ North Corona                                     │
│ Murray Hill                                      │
│ Ocean Hill                                       │
│ Marble Hill-Inwood                               │
│ College Point                                    │
│ Whitestone                                       │
│ Rosedale                                         │
│ Eastchester-Edenwald-Baychester                  │
│ Ridgewood                                        │
│ Allerton-Pelham Gardens                          │
│ Baisley Park                                     │
│ Kew Gardens                                      │
│ Claremont-Bathgate                               │
│ Woodlawn-Wakefield                               │
│ Queens Village                                   │
│ Lindenwood-Howard Beach                          │
│ West Brighton                                    │
│ Seagate-Coney Island                             │
│ Westchester-Unionport                            │
│ Kingsbridge Heights                              │
│ Sunset Park East                                 │
│ Brownsville                                      │
│ Stapleton-Rosebank                               │
│ South Jamaica                                    │
│ Bellerose                                        │
│ Co-op City                                       │
│ Van Cortlandt Village                            │
│ Flatlands                                        │
│ Corona                                           │
│ Auburndale                                       │
│ Homecrest                                        │
│ Mount Hope                                       │
└──────────────────────────────────────────────────┘
┌─pickup_ntaname─────────────────────────────────┐
│ Jamaica Estates-Holliswood                     │
│ West Farms-Bronx River                         │
│ Bronxdale                                      │
│ Morrisania-Melrose                             │
│ Georgetown-Marine Park-Bergen Beach-Mill Basin │
│ Soundview-Bruckner                             │
│ Sheepshead Bay-Gerritsen Beach-Manhattan Beach │
│ Ocean Parkway South                            │
│ Bedford Park-Fordham North                     │
│ Laurelton                                      │
│ park-cemetery-etc-Bronx                        │
│ Bensonhurst East                               │
│ Williamsbridge-Olinville                       │
│ Maspeth                                        │
│ Old Town-Dongan Hills-South Beach              │
│ East New York                                  │
│ Queensboro Hill                                │
│ Van Nest-Morris Park-Westchester Square        │
│ West New Brighton-New Brighton-St. George      │
└────────────────────────────────────────────────┘
┌─pickup_ntaname──────────────────────┐
│ Bay Ridge                           │
│ Glendale                            │
│ Glen Oaks-Floral Park-New Hyde Park │
│ Hunts Point                         │
│ New Springville-Bloomfield-Travis   │
│ Hammels-Arverne-Edgemere            │
│ Fresh Meadows-Utopia                │
│ Middle Village                      │
│ East Flatbush-Farragut              │
└─────────────────────────────────────┘
┌─pickup_ntaname───────────────────────────┐
│ Schuylerville-Throgs Neck-Edgewater Park │
│ Ozone Park                               │
│ Bayside-Bayside Hills                    │
│ Pomonok-Flushing Heights-Hillcrest       │
└──────────────────────────────────────────┘
┌─pickup_ntaname───────────────────────┐
│ Douglas Manor-Douglaston-Little Neck │
│ Crotona Park East                    │
│ Gravesend                            │
│ Springfield Gardens North            │
└──────────────────────────────────────┘
┌─pickup_ntaname────────────────────────────────────────┐
│ Ft. Totten-Bay Terrace-Clearview                      │
│ Breezy Point-Belle Harbor-Rockaway Park-Broad Channel │
│ Woodhaven                                             │
│ East Tremont                                          │
└───────────────────────────────────────────────────────┘
┌─pickup_ntaname─┐
│ Longwood       │
└────────────────┘
┌─pickup_ntaname──────────────────────┐
│ Pelham Bay-Country Club-City Island │
│ Bath Beach                          │
│ Pelham Parkway                      │
│ Madison                             │
│ Parkchester                         │
└─────────────────────────────────────┘
┌─pickup_ntaname─┐
│ St. Albans     │
│ East Flushing  │
│ Great Kills    │
│ Norwood        │
└────────────────┘
┌─pickup_ntaname───────────────────┐
│ East New York (Pennsylvania Ave) │
│ Oakland Gardens                  │
└──────────────────────────────────┘
┌─pickup_ntaname──────────────────────┐
│ North Riverdale-Fieldston-Riverdale │
└─────────────────────────────────────┘
┌─pickup_ntaname─────────┐
│ Starrett City          │
│ New Dorp-Midland Beach │
└────────────────────────┘
┌─pickup_ntaname───────────────────────────────────────────┐
│ Far Rockaway-Bayswater                                   │
│ New Brighton-Silver Lake                                 │
│ Todt Hill-Emerson Hill-Heartland Village-Lighthouse Hill │
└──────────────────────────────────────────────────────────┘
┌─pickup_ntaname─────────────────────────────────────┐
│ Mariner's Harbor-Arlington-Port Ivory-Graniteville │
│ Hollis                                             │
└────────────────────────────────────────────────────┘
┌─pickup_ntaname──────────────────┐
│ Grasmere-Arrochar-Ft. Wadsworth │
│ Cambria Heights                 │
└─────────────────────────────────┘
┌─pickup_ntaname─┐
│ Belmont        │
└────────────────┘
┌─pickup_ntaname─┐
│ Arden Heights  │
└────────────────┘
┌─pickup_ntaname────────────────┐
│ Grymes Hill-Clifton-Fox Hills │
└───────────────────────────────┘
┌─pickup_ntaname─────────────────────────────┐
│ Annadale-Huguenot-Prince's Bay-Eltingville │
└────────────────────────────────────────────┘

190 rows in set. Elapsed: 0.066 sec. Processed 2.00 million rows, 60.32 MB (30.45 million rows/s., 918.50 MB/s.)
```

- 平均チップ

```sql
b61e6fae1579 :) SELECT round(avg(tip_amount), 2) FROM trips;

SELECT round(avg(tip_amount), 2)
FROM trips

Query id: c091fb42-3929-4a06-b87e-c78ee444c9c7

┌─round(avg(tip_amount), 2)─┐
│                      1.68 │
└───────────────────────────┘

1 rows in set. Elapsed: 0.020 sec. Processed 2.00 million rows, 8.00 MB (97.79 million rows/s., 391.17 MB/s.)
```

乗客数に基づいて平均コスト

```sql
b61e6fae1579 :) SELECT
                    passenger_count,
                    ceil(avg(total_amount),2) AS average_total_amount
                FROM trips
                GROUP BY passenger_count;

SELECT
    passenger_count,
    ceil(avg(total_amount), 2) AS average_total_amount
FROM trips
GROUP BY passenger_count

Query id: 7f17fa6f-21a9-4673-8c67-29fc804ce7f7

┌─passenger_count─┬─average_total_amount─┐
│               0 │                22.69 │
│               1 │                15.97 │
│               2 │                17.15 │
│               3 │                16.76 │
│               4 │                17.33 │
│               5 │                16.35 │
│               6 │                16.04 │
│               7 │                 59.8 │
│               8 │                36.41 │
│               9 │                 9.81 │
└─────────────────┴──────────────────────┘

10 rows in set. Elapsed: 0.118 sec. Processed 2.00 million rows, 10.00 MB (16.89 million rows/s., 84.44 MB/s.)
```

地域ごとの毎日のピックアップ数

```sql
b61e6fae1579 :) SELECT
                    pickup_date,
                    pickup_ntaname,
                    SUM(1) AS number_of_trips
                FROM trips
                GROUP BY pickup_date, pickup_ntaname
                ORDER BY pickup_date ASC LIMIT 10;

SELECT
    pickup_date,
    pickup_ntaname,
    SUM(1) AS number_of_trips
FROM trips
GROUP BY
    pickup_date,
    pickup_ntaname
ORDER BY pickup_date ASC
LIMIT 10

Query id: d902c1e2-5227-4ab8-ae35-642413803db3

┌─pickup_date─┬─pickup_ntaname───────────────────────────┬─number_of_trips─┐
│  2015-07-01 │ Washington Heights South                 │               5 │
│  2015-07-01 │ North Side-South Side                    │              31 │
│  2015-07-01 │ Yorkville                                │             378 │
│  2015-07-01 │ Turtle Bay-East Midtown                  │             999 │
│  2015-07-01 │ West Concourse                           │               2 │
│  2015-07-01 │ Central Harlem South                     │              33 │
│  2015-07-01 │ Carroll Gardens-Columbia Street-Red Hook │              19 │
│  2015-07-01 │ Crown Heights North                      │               3 │
│  2015-07-01 │ Lincoln Square                           │             507 │
│  2015-07-01 │ Erasmus                                  │               1 │
└─────────────┴──────────────────────────────────────────┴─────────────────┘

10 rows in set. Elapsed: 0.115 sec. Processed 2.00 million rows, 64.32 MB (17.44 million rows/s., 560.92 MB/s.)
```

旅行行程の長さでグルーピング

```Sql
b61e6fae1579 :) SELECT
                    avg(tip_amount) AS avg_tip,
                    avg(fare_amount) AS avg_fare,
                    avg(passenger_count) AS avg_passenger,
                    count() AS count,
                    truncate(date_diff('second', pickup_datetime, dropoff_datetime)/60) as trip_minutes
                FROM trips
                WHERE trip_minutes > 0
                GROUP BY trip_minutes
                ORDER BY trip_minutes DESC LIMIT 10;

SELECT
    avg(tip_amount) AS avg_tip,
    avg(fare_amount) AS avg_fare,
    avg(passenger_count) AS avg_passenger,
    count() AS count,
    truncate(dateDiff('second', pickup_datetime, dropoff_datetime) / 60) AS trip_minutes
FROM trips
WHERE trip_minutes > 0
GROUP BY trip_minutes
ORDER BY trip_minutes DESC
LIMIT 10

Query id: 477bb7cd-dee6-4c64-81f6-282f153fef51

┌────────────avg_tip─┬───────────avg_fare─┬──────avg_passenger─┬─count─┬─trip_minutes─┐
│ 1.9600000381469727 │                  8 │                  1 │     1 │        27511 │
│                  0 │                 12 │                  2 │     1 │        27500 │
│  0.542166670008252 │ 19.716666666666665 │ 1.9166666666666667 │    60 │         1439 │
│ 0.9024999990127981 │ 11.270625001192093 │            1.95625 │   160 │         1438 │
│ 0.9715789439982938 │ 13.646616541353383 │ 2.0526315789473686 │   133 │         1437 │
│ 0.9682692375320655 │ 14.134615384615385 │  2.076923076923077 │   104 │         1436 │
│ 1.1022105198157461 │ 13.778947368421052 │  2.042105263157895 │    95 │         1435 │
│ 0.8419117647058824 │ 12.441176470588236 │ 2.3529411764705883 │    68 │         1434 │
│ 0.8942647067939534 │ 13.242647058823529 │  2.411764705882353 │    68 │         1433 │
│ 0.8565151546940659 │ 15.992424242424242 │  2.212121212121212 │    66 │         1432 │
└────────────────────┴────────────────────┴────────────────────┴───────┴──────────────┘

10 rows in set. Elapsed: 0.088 sec. Processed 2.00 million rows, 33.99 MB (22.66 million rows/s., 385.28 MB/s.)
```

各地域のピックアップ数を時間帯別に分類

```sql
b61e6fae1579 :) SELECT
                    pickup_ntaname,
                    toHour(pickup_datetime) as pickup_hour,
                    SUM(1) AS pickups
                FROM trips
                WHERE pickup_ntaname != ''
                GROUP BY pickup_ntaname, pickup_hour
                ORDER BY pickup_ntaname, pickup_hour LIMIT 10;

SELECT
    pickup_ntaname,
    toHour(pickup_datetime) AS pickup_hour,
    SUM(1) AS pickups
FROM trips
WHERE pickup_ntaname != ''
GROUP BY
    pickup_ntaname,
    pickup_hour
ORDER BY
    pickup_ntaname ASC,
    pickup_hour ASC
LIMIT 10

Query id: 07bdd9d3-d12a-4652-bd93-47dab9ddeec8

┌─pickup_ntaname─┬─pickup_hour─┬─pickups─┐
│ Airport        │           0 │    3509 │
│ Airport        │           1 │    1184 │
│ Airport        │           2 │     401 │
│ Airport        │           3 │     152 │
│ Airport        │           4 │     213 │
│ Airport        │           5 │     955 │
│ Airport        │           6 │    2161 │
│ Airport        │           7 │    3013 │
│ Airport        │           8 │    3601 │
│ Airport        │           9 │    3792 │
└────────────────┴─────────────┴─────────┘

10 rows in set. Elapsed: 0.156 sec. Processed 2.00 million rows, 68.32 MB (12.83 million rows/s., 438.31 MB/s.)
```

ラガーディア空港または JFK 空港への乗り物

```sql
b61e6fae1579 :) SELECT
                    pickup_datetime,
                    dropoff_datetime,
                    total_amount,
                    pickup_nyct2010_gid,
                    dropoff_nyct2010_gid,
                    CASE
                        WHEN dropoff_nyct2010_gid = 138 THEN 'LGA'
                        WHEN dropoff_nyct2010_gid = 132 THEN 'JFK'
                    END AS airport_code,
                    EXTRACT(YEAR FROM pickup_datetime) AS year,
                    EXTRACT(DAY FROM pickup_datetime) AS day,
                    EXTRACT(HOUR FROM pickup_datetime) AS hour
                FROM trips
                WHERE dropoff_nyct2010_gid IN (132, 138)
                ORDER BY pickup_datetime LIMIT 10;

SELECT
    pickup_datetime,
    dropoff_datetime,
    total_amount,
    pickup_nyct2010_gid,
    dropoff_nyct2010_gid,
    multiIf(dropoff_nyct2010_gid = 138, 'LGA', dropoff_nyct2010_gid = 132, 'JFK', NULL) AS airport_code,
    toYear(pickup_datetime) AS year,
    toDayOfMonth(pickup_datetime) AS day,
    toHour(pickup_datetime) AS hour
FROM trips
WHERE dropoff_nyct2010_gid IN (132, 138)
ORDER BY pickup_datetime ASC
LIMIT 10

Query id: 7b99c918-7372-4f64-b80e-5da2554322ce

┌─────pickup_datetime─┬────dropoff_datetime─┬─total_amount─┬─pickup_nyct2010_gid─┬─dropoff_nyct2010_gid─┬─airport_code─┬─year─┬─day─┬─hour─┐
│ 2015-07-01 00:04:14 │ 2015-07-01 00:15:29 │         13.3 │                 -34 │                  132 │ JFK          │ 2015 │   1 │    0 │
│ 2015-07-01 00:09:42 │ 2015-07-01 00:12:55 │          6.8 │                  50 │                  138 │ LGA          │ 2015 │   1 │    0 │
│ 2015-07-01 00:23:04 │ 2015-07-01 00:24:39 │          4.8 │                -125 │                  132 │ JFK          │ 2015 │   1 │    0 │
│ 2015-07-01 00:27:51 │ 2015-07-01 00:39:02 │        14.72 │                -101 │                  138 │ LGA          │ 2015 │   1 │    0 │
│ 2015-07-01 00:32:03 │ 2015-07-01 00:55:39 │        39.34 │                  48 │                  138 │ LGA          │ 2015 │   1 │    0 │
│ 2015-07-01 00:34:12 │ 2015-07-01 00:40:48 │         9.95 │                 -93 │                  132 │ JFK          │ 2015 │   1 │    0 │
│ 2015-07-01 00:38:26 │ 2015-07-01 00:49:00 │         13.3 │                 -11 │                  138 │ LGA          │ 2015 │   1 │    0 │
│ 2015-07-01 00:41:48 │ 2015-07-01 00:44:45 │          6.3 │                 -94 │                  132 │ JFK          │ 2015 │   1 │    0 │
│ 2015-07-01 01:06:18 │ 2015-07-01 01:14:43 │        11.76 │                  37 │                  132 │ JFK          │ 2015 │   1 │    1 │
│ 2015-07-01 01:07:34 │ 2015-07-01 01:30:56 │         23.8 │                  42 │                  138 │ LGA          │ 2015 │   1 │    1 │
└─────────────────────┴─────────────────────┴──────────────┴─────────────────────┴──────────────────────┴──────────────┴──────┴─────┴──────┘

10 rows in set. Elapsed: 0.034 sec. Processed 393.03 thousand rows, 5.50 MB (11.59 million rows/s., 162.26 MB/s.)
```

- 辞書の作成  
  0 に設定すると、LIFETIME この辞書はソースで更新されません。S3 バケットに不要なトラフィックを送信しないようにするため。

```Sql
b61e6fae1579 :) CREATE DICTIONARY taxi_zone_dictionary
                (
                  `LocationID` UInt16 DEFAULT 0,
                  `Borough` String,
                  `Zone` String,
                  `service_zone` String
                )
                PRIMARY KEY LocationID
                SOURCE(HTTP(URL 'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/taxi_zone_lookup.csv' FORMAT 'CSVWithNames'))
                LIFETIME(MIN 0 MAX 0)
                LAYOUT(HASHED_ARRAY());

CREATE DICTIONARY taxi_zone_dictionary
(
    `LocationID` UInt16 DEFAULT 0,
    `Borough` String,
    `Zone` String,
    `service_zone` String
)
PRIMARY KEY LocationID
SOURCE(HTTP(URL 'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/taxi_zone_lookup.csv' FORMAT 'CSVWithNames'))
LIFETIME(MIN 0 MAX 0)
LAYOUT(HASHED_ARRAY())

Query id: f61ee950-b3a3-4d05-9e55-721b8bb63284

Ok.

0 rows in set. Elapsed: 0.012 sec.
```

- 辞書の確認

```Sql
b61e6fae1579 :) SELECT * FROM taxi_zone_dictionary limit 10;

SELECT *
FROM taxi_zone_dictionary
LIMIT 10

Query id: b073a2a8-19ce-49b9-b992-b21e22633fed

┌─LocationID─┬─Borough───┬─Zone──────────────────────────────────────────┬─service_zone─┐
│         77 │ Brooklyn  │ East New York/Pennsylvania Avenue             │ Boro Zone    │
│        106 │ Brooklyn  │ Gowanus                                       │ Boro Zone    │
│        103 │ Manhattan │ Governor's Island/Ellis Island/Liberty Island │ Yellow Zone  │
│        179 │ Queens    │ Old Astoria                                   │ Boro Zone    │
│        260 │ Queens    │ Woodside                                      │ Boro Zone    │
│        205 │ Queens    │ Saint Albans                                  │ Boro Zone    │
│         81 │ Bronx     │ Eastchester                                   │ Boro Zone    │
│        261 │ Manhattan │ World Trade Center                            │ Yellow Zone  │
│         46 │ Bronx     │ City Island                                   │ Boro Zone    │
│         18 │ Bronx     │ Bedford Park                                  │ Boro Zone    │
└────────────┴───────────┴───────────────────────────────────────────────┴──────────────┘

10 rows in set. Elapsed: 0.005 sec.
```

存在するキーは１を返します

```sql
b61e6fae1579 :) SELECT dictHas('taxi_zone_dictionary', toUInt64(77));

SELECT dictHas('taxi_zone_dictionary', toUInt64(77))

Query id: 755c41e6-cbdb-411c-a8f9-c3d978d305b5

┌─dictHas('taxi_zone_dictionary', toUInt64(77))─┐
│                                             1 │
└───────────────────────────────────────────────┘

1 rows in set. Elapsed: 0.005 sec.

```

存在しないキーは 0 を返します

```sql
b61e6fae1579 :) SELECT dictHas('taxi_zone_dictionary', toUInt64(999));

SELECT dictHas('taxi_zone_dictionary', toUInt64(999))

Query id: 700a50c1-03a8-4009-b717-e03c4e0237ba

┌─dictHas('taxi_zone_dictionary', toUInt64(999))─┐
│                                              0 │
└────────────────────────────────────────────────┘

1 rows in set. Elapsed: 0.005 sec.
```

dictGet 関数で集計

```sql
b61e6fae1579 :) SELECT
                    count(1) AS total,
                    dictGetOrDefault('taxi_zone_dictionary','Borough', toUInt64(pickup_nyct2010_gid), 'Unknown') AS borough_name
                FROM trips
                WHERE dropoff_nyct2010_gid = 132 OR dropoff_nyct2010_gid = 138
                GROUP BY borough_name
                ORDER BY total DESC;

SELECT
    count(1) AS total,
    dictGetOrDefault('taxi_zone_dictionary', 'Borough', toUInt64(pickup_nyct2010_gid), 'Unknown') AS borough_name
FROM trips
WHERE (dropoff_nyct2010_gid = 132) OR (dropoff_nyct2010_gid = 138)
GROUP BY borough_name
ORDER BY total DESC

Query id: c63c341b-f574-46bf-9b19-27f72073f7ee

┌─total─┬─borough_name──┐
│ 23683 │ Unknown       │
│  7053 │ Manhattan     │
│  6828 │ Brooklyn      │
│  4458 │ Queens        │
│  2670 │ Bronx         │
│   554 │ Staten Island │
│    53 │ EWR           │
└───────┴───────────────┘

7 rows in set. Elapsed: 0.027 sec. Processed 2.00 million rows, 4.00 MB (74.91 million rows/s., 149.81 MB/s.)
```

上記クエリと同じ結果を JOIN で得る  
内部的には同じ処理です

```sql
b61e6fae1579 :) SELECT
                    count(1) AS total,
                    Borough
                FROM trips
                JOIN taxi_zone_dictionary ON toUInt64(trips.pickup_nyct2010_gid) = taxi_zone_dictionary.LocationID
                WHERE dropoff_nyct2010_gid = 132 OR dropoff_nyct2010_gid = 138
                GROUP BY Borough
                ORDER BY total DESC;

SELECT
    count(1) AS total,
    Borough
FROM trips
INNER JOIN taxi_zone_dictionary ON toUInt64(trips.pickup_nyct2010_gid) = taxi_zone_dictionary.LocationID
WHERE (dropoff_nyct2010_gid = 132) OR (dropoff_nyct2010_gid = 138)
GROUP BY Borough
ORDER BY total DESC

Query id: 0767939c-c6c9-4ce9-9d51-6a3eae289403

┌─total─┬─Borough───────┐
│  7053 │ Manhattan     │
│  6828 │ Brooklyn      │
│  4458 │ Queens        │
│  2670 │ Bronx         │
│   554 │ Staten Island │
│    53 │ EWR           │
└───────┴───────────────┘

6 rows in set. Elapsed: 0.030 sec. Processed 2.00 million rows, 4.00 MB (67.03 million rows/s., 134.05 MB/s.)
```

SELECT \* は遅い

```Sql
b61e6fae1579 :) SELECT *
                FROM trips
                JOIN taxi_zone_dictionary
                    ON trips.dropoff_nyct2010_gid = taxi_zone_dictionary.LocationID
                WHERE tip_amount > 0
                ORDER BY tip_amount DESC
                LIMIT 10;

SELECT *
FROM trips
INNER JOIN taxi_zone_dictionary ON trips.dropoff_nyct2010_gid = taxi_zone_dictionary.LocationID
WHERE tip_amount > 0
ORDER BY tip_amount DESC
LIMIT 10

Query id: 3d46b6b4-5755-4628-849d-0d65ad1012ac

┌────trip_id─┬─vendor_id─┬─pickup_date─┬─────pickup_datetime─┬─dropoff_date─┬────dropoff_datetime─┬─store_and_fwd_flag─┬─rate_code_id─┬───pickup_longitude─┬────pickup_latitude─┬──dropoff_longitude─┬───dropoff_latitude─┬─passenger_count─┬─trip_distance─┬─fare_amount─┬─extra─┬─mta_tax─┬─tip_amount─┬─tolls_amount─┬─ehail_fee─┬─improvement_surcharge─┬─total_amount─┬─payment_type─┬─trip_type─┬─pickup─┬─dropoff─┬─cab_type─┬─pickup_nyct2010_gid─┬─pickup_ctlabel─┬─pickup_borocode─┬─pickup_ct2010─┬─pickup_boroct2010─┬─pickup_cdeligibil─┬─pickup_ntacode─┬─pickup_ntaname─────────────────────────────┬─pickup_puma─┬─dropoff_nyct2010_gid─┬─dropoff_ctlabel─┬─dropoff_borocode─┬─dropoff_ct2010─┬─dropoff_boroct2010─┬─dropoff_cdeligibil─┬─dropoff_ntacode─┬─dropoff_ntaname───────────────────┬─dropoff_puma─┬─LocationID─┬─Borough───┬─Zone──────────────────────────────────────────┬─service_zone─┐
│ 1205906473 │ 2         │  2015-08-30 │ 2015-08-30 21:51:28 │   2015-08-30 │ 2015-08-30 21:51:29 │                  0 │            1 │                  0 │                  0 │ -73.92498016357422 │  40.84598159790039 │               1 │             0 │         2.5 │   0.5 │     0.5 │        400 │            0 │         0 │                   0.3 │        403.8 │ CSH          │         0 │        │ 5       │ yellow   │                   0 │              0 │               0 │               │ 0000000           │                   │ 0000           │                                            │           0 │                  104 │          205.01 │                2 │ Bronx          │ 2020501            │ E                  │ BX36            │ University Heights-Morris Heights │         3707 │        104 │ Manhattan │ Governor's Island/Ellis Island/Liberty Island │ Yellow Zone  │
│ 1206436163 │ 1         │  2015-08-01 │ 2015-08-01 11:19:21 │   2015-08-01 │ 2015-08-01 11:19:26 │                  0 │            2 │ -74.17740631103516 │ 40.694725036621094 │ -74.17740631103516 │  40.69472122192383 │               1 │             0 │          52 │     0 │     0.5 │        300 │            0 │         0 │                   0.3 │        352.8 │ CSH          │         0 │        │         │ yellow   │                 119 │              0 │               0 │ New Jersey    │ 0000000           │                   │ NJ01           │ Newark Airport                             │           0 │                  119 │               0 │                0 │ New Jersey     │ 0000000            │                    │ NJ01            │ Newark Airport                    │            0 │        119 │ Bronx     │ Highbridge                                    │ Boro Zone    │
│ 1203166979 │ 2         │  2015-07-22 │ 2015-07-22 21:08:55 │   2015-07-22 │ 2015-07-22 21:49:24 │                  0 │            1 │  -73.9881820678711 │  40.73405075073242 │ -73.83240509033203 │ 40.870155334472656 │               1 │         16.24 │          48 │   0.5 │     0.5 │     222.88 │            0 │         0 │                   0.3 │       272.18 │ CSH          │         0 │        │ Q       │ yellow   │                 -12 │             50 │               1 │ Manhattan     │ 1005000           │ I                 │ MN21           │ Gramercy                                   │        3808 │                   66 │          462.01 │                2 │ Bronx          │ 2046201            │ I                  │ BX13            │ Co-op City                        │         3703 │         66 │ Brooklyn  │ DUMBO/Vinegar Hill                            │ Boro Zone    │
│ 1213248521 │ 1         │  2015-08-09 │ 2015-08-09 22:26:15 │   2015-08-09 │ 2015-08-09 23:03:35 │                  0 │            1 │ -73.99111938476562 │  40.75038146972656 │  -74.1383285522461 │ 40.603248596191406 │               1 │          20.2 │        55.5 │   0.5 │     0.5 │        200 │        16.62 │         0 │                   0.3 │       273.42 │ CSH          │         0 │ �       │ #       │ yellow   │                -125 │            101 │               1 │ Manhattan     │ 1010100           │ I                 │ MN17           │ Midtown-Midtown South                      │        3807 │                   46 │          189.02 │                5 │ Staten Island  │ 5018902            │ I                  │ SI05            │ New Springville-Bloomfield-Travis │         3902 │         46 │ Bronx     │ City Island                                   │ Boro Zone    │
│ 1214126790 │ 2         │  2015-08-20 │ 2015-08-20 11:46:06 │   2015-08-20 │ 2015-08-20 11:50:38 │                  0 │            1 │  -73.9739990234375 │ 40.791786193847656 │ -73.98041534423828 │  40.78139877319336 │               1 │          0.87 │         5.5 │     0 │     0.5 │     153.31 │            0 │         0 │                   0.3 │       159.61 │ CSH          │         0 │ 8      │ 9       │ yellow   │                 -89 │            179 │               1 │ Manhattan     │ 1017900           │ I                 │ MN12           │ Upper West Side                            │        3806 │                  155 │             163 │                1 │ Manhattan      │ 1016300            │ I                  │ MN12            │ Upper West Side                   │         3806 │        155 │ Brooklyn  │ Marine Park/Mill Basin                        │ Boro Zone    │
│ 1218060491 │ 1         │  2015-09-07 │ 2015-09-07 17:37:06 │   2015-09-07 │ 2015-09-07 17:37:26 │                  0 │            5 │ -73.77068328857422 │  40.59572982788086 │ -73.77068328857422 │  40.59572982788086 │               3 │          17.3 │       68.38 │     0 │       0 │        150 │            0 │         0 │                   0.3 │       218.68 │ CSH          │         0 │        │         │ yellow   │                 114 │            992 │               4 │ Queens        │ 4099200           │ E                 │ QN12           │ Hammels-Arverne-Edgemere                   │        4114 │                  114 │             992 │                4 │ Queens         │ 4099200            │ E                  │ QN12            │ Hammels-Arverne-Edgemere          │         4114 │        114 │ Manhattan │ Greenwich Village South                       │ Yellow Zone  │
│ 1201517295 │ 1         │  2015-07-23 │ 2015-07-23 00:04:26 │   2015-07-23 │ 2015-07-23 00:08:45 │                  0 │            1 │ -73.99407196044922 │  40.75102615356445 │ -73.98656463623047 │ 40.761192321777344 │               1 │           0.8 │         5.5 │   0.5 │     0.5 │        150 │            0 │         0 │                   0.3 │        156.8 │ CSH          │         0 │ �       │ 0       │ yellow   │                -125 │            101 │               1 │ Manhattan     │ 1010100           │ I                 │ MN17           │ Midtown-Midtown South                      │        3807 │                  134 │             125 │                1 │ Manhattan      │ 1012500            │ I                  │ MN17            │ Midtown-Midtown South             │         3807 │        134 │ Queens    │ Kew Gardens                                   │ Boro Zone    │
│ 1215839820 │ 1         │  2015-09-18 │ 2015-09-18 12:33:40 │   2015-09-18 │ 2015-09-18 14:02:20 │                  0 │            2 │ -73.96794891357422 │  40.76279067993164 │ -73.77639770507812 │   40.6453971862793 │               1 │          28.1 │          52 │     0 │     0.5 │        130 │         5.54 │         0 │                   0.3 │       188.34 │ CSH          │         0 │ 7      │ 2       │ yellow   │                  22 │         114.02 │               1 │ Manhattan     │ 1011402           │ I                 │ MN40           │ Upper East Side-Carnegie Hill              │        3805 │                    8 │             716 │                4 │ Queens         │ 4071600            │ I                  │ QN98            │ Airport                           │         4105 │          8 │ Queens    │ Astoria Park                                  │ Boro Zone    │
│ 1215770015 │ 2         │  2015-09-06 │ 2015-09-06 03:43:27 │   2015-09-06 │ 2015-09-06 04:07:40 │                  0 │            1 │ -74.00188446044922 │  40.73367691040039 │ -73.91317749023438 │ 40.759342193603516 │               1 │          6.65 │        22.5 │   0.5 │     0.5 │     115.96 │            0 │         0 │                   0.3 │       139.76 │ CSH          │         0 │ I      │         │ yellow   │                 -94 │             71 │               1 │ Manhattan     │ 1007100           │ I                 │ MN23           │ West Village                               │        3810 │                   73 │             153 │                4 │ Queens         │ 4015300            │ I                  │ QN70            │ Astoria                           │         4101 │         73 │ Queens    │ East Flushing                                 │ Boro Zone    │
│ 1200260828 │ 1         │  2015-07-15 │ 2015-07-15 14:47:17 │   2015-07-15 │ 2015-07-15 14:51:26 │                  0 │            1 │ -73.99215698242188 │  40.73731994628906 │ -73.99322509765625 │ 40.734222412109375 │               1 │           0.3 │         4.5 │     0 │     0.5 │      100.1 │            0 │         0 │                   0.3 │        105.4 │ CSH          │         0 │ 4      │         │ yellow   │                 -11 │             52 │               1 │ Manhattan     │ 1005200           │ I                 │ MN13           │ Hudson Yards-Chelsea-Flatiron-Union Square │        3807 │                  201 │              61 │                1 │ Manhattan      │ 1006100            │ I                  │ MN23            │ West Village                      │         3810 │        201 │ Queens    │ Rockaway Park                                 │ Boro Zone    │
└────────────┴───────────┴─────────────┴─────────────────────┴──────────────┴─────────────────────┴────────────────────┴──────────────┴────────────────────┴────────────────────┴────────────────────┴────────────────────┴─────────────────┴───────────────┴─────────────┴───────┴─────────┴────────────┴──────────────┴───────────┴───────────────────────┴──────────────┴──────────────┴───────────┴────────┴─────────┴──────────┴─────────────────────┴────────────────┴─────────────────┴───────────────┴───────────────────┴───────────────────┴────────────────┴────────────────────────────────────────────┴─────────────┴──────────────────────┴─────────────────┴──────────────────┴────────────────┴────────────────────┴────────────────────┴─────────────────┴───────────────────────────────────┴──────────────┴────────────┴───────────┴───────────────────────────────────────────────┴──────────────┘

10 rows in set. Elapsed: 0.822 sec. Processed 2.00 million rows, 633.54 MB (2.43 million rows/s., 770.30 MB/s.)
```
